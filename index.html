<html>
    <head>
        <title>
            Ubiquit IPv6-RD template generator
        </title>
        <!-- load our ipv4 address as seen by the server -->
        <script type="text/javascript">
            function autofill_ipv4_wan() {
                fetch("ipaddr").then(response => response.json()).then(data => {
                    document.getElementById("customer_ipv4_wan_addr").value = data["ipaddr"];
                });
                update_curl_line();
            }

            function fill_provider(elem) {
                document.getElementById("isp_ipv6_prefix").value = elem.children[0].innerText;
                document.getElementById("isp_ipv4_gateway_addr").value = elem.children[1].innerText;
                update_curl_line();
            }

            function update_curl_line() {
                let params = [
                    "customer_ipv4_lan_addr_mask",
                    "isp_ipv6_prefix",
                    "isp_ipv4_gateway_addr",
                ]
                if (!should_autodetect_wan_ipv4_addr()) {
                    params.push("customer_ipv4_wan_addr");
                }
                params = params.map(param => param + "=" + encodeURIComponent(document.getElementById(param).value));
                let curl_cmd = "curl -o config.gateway.json -L '" + window.location.href + "config.gateway.json?" + params.join("&") + "'";
                document.getElementById("curl_output").innerText = curl_cmd;
            }

            function copy_curl_to_clipboard() {
                navigator.clipboard.writeText(document.getElementById("curl_output").innerText);
            }

            function should_autodetect_wan_ipv4_addr() {
                return document.getElementById("autodetect_ipv4_wan_addr").checked;
            }

            function update_autodetect() {
                let autodetect = should_autodetect_wan_ipv4_addr();
                document.getElementById("customer_ipv4_wan_addr").disabled = autodetect;
                if (autodetect) {
                    autofill_ipv4_wan();
                }
                update_curl_line();
            }
        </script>
    </head>
    <body onload="autofill_ipv4_wan()">
        <h1>Enter your network parameters below:</h1>
        <form action="config.gateway.json" method="get">
            <label for="customer_ipv4_lan_addr_mask">Customer IPv4 LAN address (with mask):</label>
            <input type="text" name="customer_ipv4_lan_addr_mask" id="customer_ipv4_lan_addr_mask" onkeyup="update_curl_line()" placeholder="192.168.1.1/24"><br/>
            <label for="customer_ipv4_wan_addr">Customer IPv4 WAN address:</label>
            <input type="text" name="customer_ipv4_wan_addr" id="customer_ipv4_wan_addr" onkeyup="update_curl_line()" placeholder="123.45.67.89">
            <label for="autodetect_ipv4_wan_addr">Autodetect WAN addr</label><input type="checkbox" id="autodetect_ipv4_wan_addr" onchange="update_autodetect()"><br/>
            <label for="isp_ipv6_prefix">Provider IPv6 prefix (with mask):</label>
            <input type="text" name="isp_ipv6_prefix" id="isp_ipv6_prefix" onkeyup="update_curl_line()" placeholder="2602::/24"><br/>
            <label for="isp_ipv4_gateway_addr">Provider IPv4 6rd gateway:</label>
            <input type="text" name="isp_ipv4_gateway_addr" id="isp_ipv4_gateway_addr" onkeyup="update_curl_line()" placeholder="205.171.2.64"><br/>
            <input type="submit" value="Generate config.gateway.json">
        </form>

        <div style="width:80%;padding-left:5%;padding-right:5%">
            <code onclick="copy_curl_to_clipboard()" id="curl_output"></code>
        </div>

        <br/><br/>
        <h2>Table of known IPv6 provider prefixes/gateways:</h2>
        <ul>
            <li onclick="fill_provider(this)">Centurylink: <code>2602::/24</code> &nbsp;-&nbsp; </b><code>205.171.2.64</code></li>
        </ul>

        <br/><br/><br/><br/>
        <h3>Legal</h3>
        You use this software completely at your own risk; I am not responsible for anything bad that happens to your network by using the templates generated by this service.
    </body>
</html>